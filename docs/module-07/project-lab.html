<!DOCTYPE html>
<html>
<head>
	<title>Module 07: Project 7 Lab - Admin Secure Pages</title>
    <style>
        @font-face {
            font-family: 'icomoon';
            src: url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.eot');
            src: url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.eot#iefix-8k8p81') format('embedded-opentype'), url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.ttf') format('truetype'), url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.woff') format('woff'), url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.svg#icomoon') format('svg');
            font-weight: normal;
            font-style: normal;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">    
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">        

    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/reset.css">
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/fonts/fontawesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/lib/katex/katex.min.css">
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/lib/highlight/styles/monokai-sublime.min.css">
	<link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/cse450.css?v1.5.7">
    <meta charset="utf-8">

</head>
<body class="index-page">
     <div id="modal-screen">
        <div id="contents-wrapper">
            <div class="toc">
<ul>
<li><a href="#product-objective">Product Objective</a></li>
<li><a href="#login">Login</a></li>
<li><a href="#create-lambda">Create lambda</a></li>
<li><a href="#update-getservicerequest-not-admingetservicerequest">Update getServiceRequest (NOT adminGetServiceRequest)</a></li>
<li><a href="#create-a-new-api-gateway-resource">Create a new API Gateway resource</a></li>
<li><a href="#create-an-authorizer">Create an Authorizer</a></li>
<li><a href="#create-a-get-method">Create a Get Method</a></li>
<li><a href="#update-code">Update code</a></li>
<li><a href="#lab-summary">Lab Summary:</a><ul>
<li><a href="#key-concepts-explained">Key Concepts Explained:</a></li>
<li><a href="#reflective-questions">Reflective Questions:</a></li>
</ul>
</li>
</ul>
</div>

            <a href="#" id="hide-contents" title="Close Table of Contents"><i class="far fa-window-close"></i></a>
        </div>
    </div>
	<header>
        <span class="icon-byui-logo"></span>
        <div id="titles">
            <h1>ITM 300 - Cloud Foundations</h1>
            <h2>Module 07: Project 7 Lab - Admin Secure Pages</h2>
            <nav><a href="https://byui-cse.github.io/itm300-course"><i class="fas fa-home"></i></a><a href="https://byui-cse.github.io/itm300-course/modules/">Modules</a><a href="https://byui-cse.github.io/itm300-course/test-prep/">Test Prep</a></nav>
        </div>
        <a href="#" id="show-contents" title="Show Table of Contents"><i class="far fa-list-alt"></i></a>
    </header>
	<article>
		<p><img alt="Quick Oil Change and Repair" src="https://byui-cse.github.io/itm300-course/shared/img/quick-logo-fancy-service-requests.jpg" />
<em><a href="https://openai.com/dall-e-3">Photo by Dall-E-3</a></em></p>
<h2 id="product-objective">Product Objective</h2>
<p>For this lab we'll build and integrate an API to handle data securely for the technicians. We'll also increase security for the service requests by only sending data required for the display.</p>
<h2 id="login">Login</h2>
<p>Before you begin, make sure that you can login to the web app. Open up your Quick Oil Change app and click on "Login".</p>
<p>You can use the credentials you created earlier for janedoe</p>
<ul>
<li>Username: <strong>janedoe</strong></li>
<li>Password: <strong>Ilove2SeeTheTemple!!</strong></li>
</ul>
<p>If that password doesn't work, try <strong>ILove2SeeTheTemple!</strong></p>
<div class="admonition key">
<p class="admonition-title">Previous Labs</p>
<p>If you are unable to login, please go back and complete <a href="https://byui-cse.github.io/itm300-course/module-03/project-lab.html">Lab 3</a>. This lab requires you to be able to login to the app.</p>
</div>
<h2 id="create-lambda">Create lambda</h2>
<p>Create a new lambda function:</p>
<ul>
<li><span class="amz-orange-button">Create function</span></li>
<li>Name: adminGetServiceRequest</li>
<li>Runtime: Node.js 20.x (or the latest version)</li>
<li><span class="amz-white-button">Change default execution role</span></li>
<li>Use exisiting role</li>
<li>Existing Role: LabRole</li>
</ul>
<p>Create a file named <em>adminDynamoService.mjs</em></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="p">{</span> <span class="n">DynamoDBClient</span> <span class="p">}</span> <span class="kn">from</span> <span class="s2">&quot;@aws-sdk/client-dynamodb&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span>
  <span class="n">DynamoDBDocumentClient</span><span class="p">,</span>
  <span class="n">ScanCommand</span><span class="p">,</span>
  <span class="n">PutCommand</span><span class="p">,</span>
  <span class="n">GetCommand</span><span class="p">,</span>
  <span class="n">DeleteCommand</span><span class="p">,</span>
  <span class="n">UpdateCommand</span><span class="p">,</span>
<span class="p">}</span> <span class="kn">from</span> <span class="s2">&quot;@aws-sdk/lib-dynamodb&quot;</span><span class="p">;</span>

<span class="n">const</span> <span class="n">client</span> <span class="o">=</span> <span class="n">new</span> <span class="n">DynamoDBClient</span><span class="p">({});</span>

<span class="n">const</span> <span class="n">mydynamodb</span> <span class="o">=</span> <span class="n">DynamoDBDocumentClient</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>

<span class="n">const</span> <span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;VehicleServices&quot;</span><span class="p">;</span>    

<span class="n">export</span> <span class="n">const</span> <span class="n">getDynamoServiceRequests</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">statusToExclude</span> <span class="o">=</span> <span class="s2">&quot;Completed&quot;</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">statusToExcludeRejected</span> <span class="o">=</span> <span class="s2">&quot;Service Rejected&quot;</span><span class="p">;</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="n">const</span> <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">TableName</span><span class="p">:</span> <span class="n">tableName</span><span class="p">,</span>
            <span class="n">FilterExpression</span><span class="p">:</span> <span class="s2">&quot;attribute_not_exists(service_status) OR (#service_status &lt;&gt; :status AND #service_status &lt;&gt; :statusRejected)&quot;</span><span class="p">,</span>
            <span class="n">ExpressionAttributeNames</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;#service_status&quot;</span><span class="p">:</span> <span class="s2">&quot;service_status&quot;</span>
            <span class="p">},</span>
            <span class="n">ExpressionAttributeValues</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;:status&quot;</span><span class="p">:</span> <span class="n">statusToExclude</span><span class="p">,</span>
                <span class="s2">&quot;:statusRejected&quot;</span><span class="p">:</span><span class="n">statusToExcludeRejected</span>
            <span class="p">}</span>
        <span class="p">};</span>      
        <span class="n">const</span> <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">mydynamodb</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">new</span> <span class="n">ScanCommand</span><span class="p">(</span><span class="n">params</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">body</span><span class="o">.</span><span class="n">Items</span><span class="p">;</span> <span class="o">//</span> <span class="n">Return</span> <span class="n">JSON</span> <span class="n">string</span> <span class="n">of</span> <span class="n">items</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error fetching DynamoDB service requests:&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
        <span class="n">throw</span> <span class="n">error</span><span class="p">;</span> <span class="o">//</span> <span class="n">Re</span><span class="o">-</span><span class="n">throw</span> <span class="n">the</span> <span class="n">error</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">it</span> <span class="n">further</span> <span class="n">up</span> <span class="n">the</span> <span class="n">call</span> <span class="n">stack</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">export</span> <span class="n">const</span> <span class="n">addDynamoServiceRequest</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="n">requestBody</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">serviceId</span> <span class="o">=</span> <span class="n">generateServiceId</span><span class="p">();</span> <span class="o">//</span> <span class="n">Generate</span> <span class="n">unique</span> <span class="n">service_id</span> <span class="n">based</span> <span class="n">on</span> <span class="n">current</span> <span class="n">date</span> <span class="ow">and</span> <span class="n">time</span>      
    <span class="n">const</span> <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">TableName</span><span class="p">:</span> <span class="n">tableName</span><span class="p">,</span>
      <span class="n">Item</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">service_id</span><span class="p">:</span> <span class="n">serviceId</span><span class="p">,</span> <span class="o">//</span> <span class="n">Assuming</span> <span class="n">service_id</span> <span class="ow">is</span> <span class="n">provided</span> <span class="ow">in</span> <span class="n">requestBody</span>
        <span class="n">service_status</span><span class="p">:</span> <span class="s2">&quot;New Request&quot;</span><span class="p">,</span>
        <span class="n">service_description</span><span class="p">:</span> <span class="n">requestBody</span><span class="o">.</span><span class="n">service_description</span><span class="p">,</span>
        <span class="n">phone_number</span><span class="p">:</span> <span class="n">requestBody</span><span class="o">.</span><span class="n">phone_number</span><span class="p">,</span>
        <span class="n">license_plate</span><span class="p">:</span> <span class="n">requestBody</span><span class="o">.</span><span class="n">license_plate</span> <span class="err">??</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="o">//</span> <span class="n">Use</span> <span class="n">requestBody</span><span class="o">.</span><span class="n">license_number</span> <span class="ow">or</span> <span class="n">default</span> <span class="n">to</span> <span class="s2">&quot;Unknown&quot;</span>
      <span class="p">},</span>
    <span class="p">};</span>

    <span class="k">await</span> <span class="n">mydynamodb</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">new</span> <span class="n">PutCommand</span><span class="p">(</span><span class="n">params</span><span class="p">));</span>

    <span class="k">return</span> <span class="err">`</span><span class="n">Successfully</span> <span class="n">added</span> <span class="n">new</span> <span class="n">service</span> <span class="n">request</span><span class="err">`</span><span class="p">;</span>
  <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error adding DynamoDB service request:&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
    <span class="n">throw</span> <span class="n">error</span><span class="p">;</span> <span class="o">//</span> <span class="n">Re</span><span class="o">-</span><span class="n">throw</span> <span class="n">the</span> <span class="n">error</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">it</span> <span class="n">further</span> <span class="n">up</span> <span class="n">the</span> <span class="n">call</span> <span class="n">stack</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="n">export</span> <span class="n">const</span> <span class="n">updateDynamoServiceRequest</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="n">requestBody</span><span class="p">,</span> <span class="n">serviceId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>

    <span class="n">const</span> <span class="n">licensePlate</span> <span class="o">=</span> <span class="n">requestBody</span><span class="o">.</span><span class="n">license_plate</span> <span class="err">??</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">the</span> <span class="n">item</span> <span class="n">exists</span>
    <span class="n">const</span> <span class="n">getParams</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">TableName</span><span class="p">:</span> <span class="n">tableName</span><span class="p">,</span>
      <span class="n">Key</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">service_id</span><span class="p">:</span> <span class="n">serviceId</span><span class="p">,</span>
        <span class="n">license_plate</span><span class="p">:</span> <span class="n">licensePlate</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">};</span>

    <span class="n">const</span> <span class="p">{</span> <span class="n">Item</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="n">mydynamodb</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">new</span> <span class="n">GetCommand</span><span class="p">(</span><span class="n">getParams</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">Item</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">throw</span> <span class="n">new</span> <span class="n">Error</span><span class="p">(</span><span class="s2">&quot;No record found&quot;</span><span class="p">);</span>
    <span class="p">}</span>    

    <span class="o">//</span> <span class="n">Initialize</span> <span class="n">the</span> <span class="n">UpdateExpression</span> <span class="n">components</span>
    <span class="n">let</span> <span class="n">updateExpression</span> <span class="o">=</span> <span class="s2">&quot;set&quot;</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">expressionAttributeNames</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="n">const</span> <span class="n">expressionAttributeValues</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="o">//</span> <span class="n">Dynamically</span> <span class="n">build</span> <span class="n">the</span> <span class="n">UpdateExpression</span><span class="p">,</span> <span class="n">ExpressionAttributeNames</span><span class="p">,</span> <span class="ow">and</span> <span class="n">ExpressionAttributeValues</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">requestBody</span><span class="o">.</span><span class="n">service_description</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">updateExpression</span> <span class="o">+=</span> <span class="s2">&quot; #sd = :sd,&quot;</span><span class="p">;</span>
      <span class="n">expressionAttributeNames</span><span class="p">[</span><span class="s2">&quot;#sd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;service_description&quot;</span><span class="p">;</span>
      <span class="n">expressionAttributeValues</span><span class="p">[</span><span class="s2">&quot;:sd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requestBody</span><span class="o">.</span><span class="n">service_description</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">requestBody</span><span class="o">.</span><span class="n">phone_number</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">updateExpression</span> <span class="o">+=</span> <span class="s2">&quot; #pn = :pn,&quot;</span><span class="p">;</span>
      <span class="n">expressionAttributeNames</span><span class="p">[</span><span class="s2">&quot;#pn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;phone_number&quot;</span><span class="p">;</span>
      <span class="n">expressionAttributeValues</span><span class="p">[</span><span class="s2">&quot;:pn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requestBody</span><span class="o">.</span><span class="n">phone_number</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">requestBody</span><span class="o">.</span><span class="n">service_status</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">updateExpression</span> <span class="o">+=</span> <span class="s2">&quot; #ss = :ss,&quot;</span><span class="p">;</span>
      <span class="n">expressionAttributeNames</span><span class="p">[</span><span class="s2">&quot;#ss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;service_status&quot;</span><span class="p">;</span>
      <span class="n">expressionAttributeValues</span><span class="p">[</span><span class="s2">&quot;:ss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requestBody</span><span class="o">.</span><span class="n">service_status</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">Remove</span> <span class="nb">any</span> <span class="n">trailing</span> <span class="n">comma</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">update</span> <span class="n">expression</span>
    <span class="n">updateExpression</span> <span class="o">=</span> <span class="n">updateExpression</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">/</span><span class="p">,</span><span class="err">$</span><span class="o">/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>

    <span class="n">const</span> <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">TableName</span><span class="p">:</span> <span class="n">tableName</span><span class="p">,</span>
      <span class="n">Key</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">service_id</span><span class="p">:</span> <span class="n">serviceId</span><span class="p">,</span>
        <span class="n">license_plate</span><span class="p">:</span> <span class="n">requestBody</span><span class="o">.</span><span class="n">license_plate</span> <span class="err">??</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="o">//</span> <span class="n">Assuming</span> <span class="n">license_plate</span> <span class="ow">is</span> <span class="n">part</span> <span class="n">of</span> <span class="n">the</span> <span class="n">key</span>
      <span class="p">},</span>
      <span class="n">UpdateExpression</span><span class="p">:</span> <span class="n">updateExpression</span><span class="p">,</span>
      <span class="n">ExpressionAttributeNames</span><span class="p">:</span> <span class="n">expressionAttributeNames</span><span class="p">,</span>
      <span class="n">ExpressionAttributeValues</span><span class="p">:</span> <span class="n">expressionAttributeValues</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="k">await</span> <span class="n">mydynamodb</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">new</span> <span class="n">UpdateCommand</span><span class="p">(</span><span class="n">params</span><span class="p">));</span>

    <span class="k">return</span> <span class="err">`</span><span class="n">Successfully</span> <span class="n">updated</span> <span class="n">service</span> <span class="n">request</span><span class="err">`</span><span class="p">;</span>
  <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">message</span> <span class="o">===</span> <span class="s2">&quot;No record found&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error updating DynamoDB service request:&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
      <span class="n">throw</span> <span class="n">error</span><span class="p">;</span> <span class="o">//</span> <span class="n">Re</span><span class="o">-</span><span class="n">throw</span> <span class="n">the</span> <span class="n">error</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">it</span> <span class="n">further</span> <span class="n">up</span> <span class="n">the</span> <span class="n">call</span> <span class="n">stack</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>



<span class="o">//</span> <span class="n">Helper</span> <span class="n">function</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">a</span> <span class="n">unique</span> <span class="n">service_id</span> <span class="n">based</span> <span class="n">on</span> <span class="n">current</span> <span class="n">date</span> <span class="ow">and</span> <span class="n">time</span>
<span class="n">const</span> <span class="n">generateServiceId</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">now</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Date</span><span class="p">();</span>
  <span class="n">const</span> <span class="n">formattedDate</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">toISOString</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">/</span><span class="p">[</span><span class="o">-</span><span class="n">T</span><span class="p">:</span><span class="o">.</span><span class="n">Z</span><span class="p">]</span><span class="o">/</span><span class="n">g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span> <span class="o">//</span> <span class="n">Format</span> <span class="n">date</span> <span class="n">string</span>
  <span class="n">const</span> <span class="n">milliseconds</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">getMilliseconds</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span><span class="o">.</span><span class="n">padStart</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">);</span> <span class="o">//</span> <span class="n">Get</span> <span class="n">milliseconds</span> <span class="ow">and</span> <span class="n">pad</span> <span class="k">with</span> <span class="n">leading</span> <span class="n">zeros</span> <span class="k">if</span> <span class="n">necessary</span>
  <span class="k">return</span> <span class="err">`$</span><span class="p">{</span><span class="n">formattedDate</span><span class="p">}</span><span class="err">$</span><span class="p">{</span><span class="n">milliseconds</span><span class="p">}</span><span class="err">`</span><span class="p">;</span> <span class="o">//</span> <span class="n">Concatenate</span> <span class="n">date</span> <span class="ow">and</span> <span class="n">milliseconds</span>
<span class="p">};</span>
</code></pre></div>

<p>Update the <em>index.mjs</em> with the following code:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="p">{</span> <span class="n">getDynamoServiceRequests</span><span class="p">,</span> <span class="n">addDynamoServiceRequest</span><span class="p">,</span> <span class="n">updateDynamoServiceRequest</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;./adminDynamoService.mjs&#39;</span><span class="p">;</span>

<span class="n">const</span> <span class="n">commonHeaders</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">:</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">:</span> <span class="s1">&#39;OPTIONS,POST,GET,PUT&#39;</span>
<span class="p">};</span>

<span class="n">export</span> <span class="n">const</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>

    <span class="n">const</span> <span class="n">httpMethod</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">httpMethod</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">path</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">path</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">resource</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">resource</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">pathParameters</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pathParameters</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">queryParameters</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">queryStringParameters</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">requestBody</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">body</span> <span class="err">?</span> <span class="n">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">body</span><span class="p">)</span> <span class="p">:</span> <span class="n">null</span><span class="p">;</span>    
    <span class="n">let</span> <span class="n">jsonArray</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="n">switch</span> <span class="p">(</span><span class="n">httpMethod</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>    
        <span class="n">jsonArray</span> <span class="o">=</span> <span class="k">await</span> <span class="n">getDynamoServiceRequests</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s2">&quot;PUT&quot;</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;puting&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pathParameters</span> <span class="o">&amp;&amp;</span> <span class="n">pathParameters</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">jsonArray</span> <span class="o">=</span> <span class="k">await</span> <span class="n">updateDynamoServiceRequest</span><span class="p">(</span><span class="n">requestBody</span><span class="p">,</span><span class="n">pathParameters</span><span class="o">.</span><span class="n">id</span><span class="p">);</span>
          <span class="o">//</span> <span class="n">jsonArray</span> <span class="o">=</span> <span class="err">`$</span><span class="p">{</span><span class="n">pathParameters</span><span class="o">.</span><span class="n">id</span><span class="p">}</span> <span class="err">$</span><span class="p">{</span><span class="n">requestBody</span><span class="p">}</span><span class="err">`</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="n">jsonArray</span> <span class="o">=</span> <span class="s2">&quot;Missing ID&quot;</span>
        <span class="p">}</span>
        <span class="o">//</span> <span class="n">jsonArray</span> <span class="o">=</span> <span class="s2">&quot;Posted&quot;</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>

    <span class="p">}</span>

    <span class="n">const</span> <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">statusCode</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
      <span class="n">body</span><span class="p">:</span> <span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">jsonArray</span><span class="p">),</span>
      <span class="n">headers</span><span class="p">:</span> <span class="n">commonHeaders</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="n">response</span><span class="p">;</span>
  <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error:&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
    <span class="n">const</span> <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">statusCode</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
      <span class="n">body</span><span class="p">:</span> <span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">({</span> <span class="n">message</span><span class="p">:</span> <span class="s1">&#39;Internal Server Error&#39;</span> <span class="p">}),</span>
      <span class="n">headers</span><span class="p">:</span> <span class="n">commonHeaders</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="n">response</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<h2 id="update-getservicerequest-not-admingetservicerequest">Update getServiceRequest (NOT adminGetServiceRequest)</h2>
<p>We are going to update the original getServiceRequest to only send information that is needed for the regular users. Go to the lambda function you have created and click on <span class="amz-link">getServiceRequest</span></p>
<p>Update <em>dynamoService.mjs</em> (Make sure you are NOT updating adminDynamoService)</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="p">{</span> <span class="n">DynamoDBClient</span> <span class="p">}</span> <span class="kn">from</span> <span class="s2">&quot;@aws-sdk/client-dynamodb&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span>
  <span class="n">DynamoDBDocumentClient</span><span class="p">,</span>
  <span class="n">ScanCommand</span><span class="p">,</span>
  <span class="n">PutCommand</span><span class="p">,</span>
  <span class="n">GetCommand</span><span class="p">,</span>
  <span class="n">DeleteCommand</span><span class="p">,</span>
<span class="p">}</span> <span class="kn">from</span> <span class="s2">&quot;@aws-sdk/lib-dynamodb&quot;</span><span class="p">;</span>

<span class="n">const</span> <span class="n">client</span> <span class="o">=</span> <span class="n">new</span> <span class="n">DynamoDBClient</span><span class="p">({});</span>

<span class="n">const</span> <span class="n">mydynamodb</span> <span class="o">=</span> <span class="n">DynamoDBDocumentClient</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>

<span class="n">const</span> <span class="n">tableName</span> <span class="o">=</span> <span class="s2">&quot;VehicleServices&quot;</span><span class="p">;</span>    

<span class="n">export</span> <span class="n">const</span> <span class="n">getDynamoServiceRequests</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">statusToExclude</span> <span class="o">=</span> <span class="s2">&quot;Completed&quot;</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">statusToExcludeNew</span> <span class="o">=</span> <span class="s2">&quot;New Request&quot;</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">statusToExcludeRejected</span> <span class="o">=</span> <span class="s2">&quot;Service Rejected&quot;</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">const</span> <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">TableName</span><span class="p">:</span> <span class="n">tableName</span><span class="p">,</span>
            <span class="n">FilterExpression</span><span class="p">:</span> <span class="s2">&quot;attribute_not_exists(service_status) OR (#service_status &lt;&gt; :status AND #service_status &lt;&gt; :statusNew AND #service_status &lt;&gt; :statusRejected)&quot;</span><span class="p">,</span>
            <span class="n">ExpressionAttributeNames</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;#service_status&quot;</span><span class="p">:</span> <span class="s2">&quot;service_status&quot;</span><span class="p">,</span>
                <span class="s2">&quot;#service_id&quot;</span><span class="p">:</span><span class="s2">&quot;service_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;#phone_number&quot;</span><span class="p">:</span> <span class="s2">&quot;phone_number&quot;</span> <span class="o">//</span> <span class="n">Add</span> <span class="n">license_plate</span> <span class="n">to</span> <span class="n">ExpressionAttributeNames0</span>
            <span class="p">},</span>
            <span class="n">ExpressionAttributeValues</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;:status&quot;</span><span class="p">:</span> <span class="n">statusToExclude</span><span class="p">,</span>
                <span class="s2">&quot;:statusNew&quot;</span><span class="p">:</span> <span class="n">statusToExcludeNew</span><span class="p">,</span>
                <span class="s2">&quot;:statusRejected&quot;</span><span class="p">:</span> <span class="n">statusToExcludeRejected</span>
            <span class="p">},</span>
            <span class="n">ProjectionExpression</span><span class="p">:</span> <span class="s2">&quot;#service_status, #service_id, #phone_number&quot;</span> <span class="o">//</span> <span class="n">Specify</span> <span class="n">the</span> <span class="n">attributes</span> <span class="n">to</span> <span class="n">retrieve</span>
        <span class="p">};</span>      
        <span class="n">const</span> <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">mydynamodb</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">new</span> <span class="n">ScanCommand</span><span class="p">(</span><span class="n">params</span><span class="p">));</span>
        <span class="o">//</span> <span class="n">Process</span> <span class="n">the</span> <span class="n">items</span> <span class="n">to</span> <span class="n">include</span> <span class="n">only</span> <span class="n">the</span> <span class="n">last</span> <span class="n">four</span> <span class="n">digits</span> <span class="n">of</span> <span class="n">the</span> <span class="n">phone</span> <span class="n">number</span>
        <span class="n">const</span> <span class="n">processedItems</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">Items</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">item</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="n">const</span> <span class="n">processedItem</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">service_status</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">service_status</span><span class="p">,</span>
                <span class="n">service_id</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">service_id</span><span class="p">,</span>
                <span class="n">phone_number</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">phone_number</span> <span class="err">?</span> <span class="n">item</span><span class="o">.</span><span class="n">phone_number</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="p">:</span> <span class="n">null</span> <span class="o">//</span> <span class="n">Extract</span> <span class="n">the</span> <span class="n">last</span> <span class="n">four</span> <span class="n">digits</span>
            <span class="p">};</span>
            <span class="k">return</span> <span class="n">processedItem</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="n">processedItems</span><span class="p">;</span>        
        <span class="o">//</span> <span class="k">return</span> <span class="n">body</span><span class="o">.</span><span class="n">Items</span><span class="p">;</span> <span class="o">//</span> <span class="n">Return</span> <span class="n">JSON</span> <span class="n">string</span> <span class="n">of</span> <span class="n">items</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error fetching DynamoDB service requests:&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
        <span class="n">throw</span> <span class="n">error</span><span class="p">;</span> <span class="o">//</span> <span class="n">Re</span><span class="o">-</span><span class="n">throw</span> <span class="n">the</span> <span class="n">error</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">it</span> <span class="n">further</span> <span class="n">up</span> <span class="n">the</span> <span class="n">call</span> <span class="n">stack</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">export</span> <span class="n">const</span> <span class="n">addDynamoServiceRequest</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="n">requestBody</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">serviceId</span> <span class="o">=</span> <span class="n">generateServiceId</span><span class="p">();</span> <span class="o">//</span> <span class="n">Generate</span> <span class="n">unique</span> <span class="n">service_id</span> <span class="n">based</span> <span class="n">on</span> <span class="n">current</span> <span class="n">date</span> <span class="ow">and</span> <span class="n">time</span>      
    <span class="n">const</span> <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">TableName</span><span class="p">:</span> <span class="n">tableName</span><span class="p">,</span>
      <span class="n">Item</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">service_id</span><span class="p">:</span> <span class="n">serviceId</span><span class="p">,</span> <span class="o">//</span> <span class="n">Assuming</span> <span class="n">service_id</span> <span class="ow">is</span> <span class="n">provided</span> <span class="ow">in</span> <span class="n">requestBody</span>
        <span class="n">service_status</span><span class="p">:</span> <span class="s2">&quot;New Request&quot;</span><span class="p">,</span>
        <span class="n">service_description</span><span class="p">:</span> <span class="n">requestBody</span><span class="o">.</span><span class="n">service_description</span><span class="p">,</span>
        <span class="n">phone_number</span><span class="p">:</span> <span class="n">requestBody</span><span class="o">.</span><span class="n">phone_number</span><span class="p">,</span>
        <span class="n">license_plate</span><span class="p">:</span> <span class="n">requestBody</span><span class="o">.</span><span class="n">license_plate</span> <span class="err">??</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="o">//</span> <span class="n">Use</span> <span class="n">requestBody</span><span class="o">.</span><span class="n">license_number</span> <span class="ow">or</span> <span class="n">default</span> <span class="n">to</span> <span class="s2">&quot;Unknown&quot;</span>
      <span class="p">},</span>
    <span class="p">};</span>

    <span class="k">await</span> <span class="n">mydynamodb</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">new</span> <span class="n">PutCommand</span><span class="p">(</span><span class="n">params</span><span class="p">));</span>

    <span class="k">return</span> <span class="err">`</span><span class="n">Successfully</span> <span class="n">added</span> <span class="n">new</span> <span class="n">service</span> <span class="n">request</span><span class="err">`</span><span class="p">;</span>
  <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error adding DynamoDB service request:&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
    <span class="n">throw</span> <span class="n">error</span><span class="p">;</span> <span class="o">//</span> <span class="n">Re</span><span class="o">-</span><span class="n">throw</span> <span class="n">the</span> <span class="n">error</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">it</span> <span class="n">further</span> <span class="n">up</span> <span class="n">the</span> <span class="n">call</span> <span class="n">stack</span>
  <span class="p">}</span>
<span class="p">};</span>



<span class="o">//</span> <span class="n">Helper</span> <span class="n">function</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">a</span> <span class="n">unique</span> <span class="n">service_id</span> <span class="n">based</span> <span class="n">on</span> <span class="n">current</span> <span class="n">date</span> <span class="ow">and</span> <span class="n">time</span>
<span class="n">const</span> <span class="n">generateServiceId</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">now</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Date</span><span class="p">();</span>
  <span class="n">const</span> <span class="n">formattedDate</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">toISOString</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">/</span><span class="p">[</span><span class="o">-</span><span class="n">T</span><span class="p">:</span><span class="o">.</span><span class="n">Z</span><span class="p">]</span><span class="o">/</span><span class="n">g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span> <span class="o">//</span> <span class="n">Format</span> <span class="n">date</span> <span class="n">string</span>
  <span class="n">const</span> <span class="n">milliseconds</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">getMilliseconds</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span><span class="o">.</span><span class="n">padStart</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">);</span> <span class="o">//</span> <span class="n">Get</span> <span class="n">milliseconds</span> <span class="ow">and</span> <span class="n">pad</span> <span class="k">with</span> <span class="n">leading</span> <span class="n">zeros</span> <span class="k">if</span> <span class="n">necessary</span>
  <span class="k">return</span> <span class="err">`$</span><span class="p">{</span><span class="n">formattedDate</span><span class="p">}</span><span class="err">$</span><span class="p">{</span><span class="n">milliseconds</span><span class="p">}</span><span class="err">`</span><span class="p">;</span> <span class="o">//</span> <span class="n">Concatenate</span> <span class="n">date</span> <span class="ow">and</span> <span class="n">milliseconds</span>
<span class="p">};</span>
</code></pre></div>

<h2 id="create-a-new-api-gateway-resource">Create a new API Gateway resource</h2>
<p>We'll add a new endpoint which will provide a secure location for our logged in users to pull information. </p>
<p>Go to our vehicleapp API Gateway. Click on the /.</p>
<ul>
<li>Click <span class="amz-white-button">Create resource</span></li>
<li>Resource Name: admin-service-request</li>
<li>Check CORS  </li>
</ul>
<h2 id="create-an-authorizer">Create an Authorizer</h2>
<p>We can enhance our API Gateway endpoint by integrating an authorizer. By linking our Cognito service to the endpoint, we can verify that each request includes a valid token. The gateway will verify this token before executing the code, providing an added layer of security.</p>
<ul>
<li>On the left hand side of the API Gateway choose <strong>Authorizers</strong></li>
<li><span class="amz-orange-button">Create Authorizer</span></li>
<li>Authorizer Name: <strong>AdminServiceRequestAuthorizer</strong></li>
<li>Authorizer Type: <strong>Cognito</strong></li>
<li>Cognito User Pool: <strong>VehicleApp</strong></li>
<li>Token Source: <strong>Authorization</strong></li>
<li><span class="amz-orange-button">Create Authorizer</span></li>
</ul>
<h2 id="create-a-get-method">Create a Get Method</h2>
<ul>
<li>Create a Get Method under admin-service-requests</li>
<li>Get</li>
<li>Lambda Proxy: turn on</li>
<li>lambda: <strong>adminGetServiceRequest</strong></li>
<li>Method request settings -&gt; Authorization: AdminServiceRequestAuthorizer</li>
<li><span class="aws-orange-button">Create method</span></li>
</ul>
<p>Create a new resource under /admin-service-requests</p>
<ul>
<li>Click on <span class="amz-white-button">/admin-service-requests</span></li>
<li>Click <span class="amz-white-button">Create resource</span></li>
<li>Don't turn on Proxy</li>
<li>Resource Path: /admin-service-request/</li>
<li>Resource Name: {id}</li>
<li>check CORS </li>
</ul>
<p>We will create a PUT method for the new resource /admin-service-requests/{id} that we just created.</p>
<ul>
<li>Create Method: PUT</li>
<li>Lambda</li>
<li>Lambda Proxy Integration</li>
<li>adminGetServiceRequest</li>
<li>Method request Settings -&gt; Authorization: AdminServiceRequestAuthorizer</li>
</ul>
<p><img alt="admin-service-request" src="https://byui-cse.github.io/itm300-course/shared/img/admin-service-request.jpg" /></p>
<p><span class="amz-orange-button">Deploy API</span></p>
<h2 id="update-code">Update code</h2>
<p><span class="amz-white-button">Connect</span> to your Vehicle App EC2 Instance</p>
<p>Download the newest website app:</p>
<div class="codehilite"><pre><span></span><code>wget https://github.com/byui-cse/itm300-course/raw/main/source/module-07/rebuildapp.sh
</code></pre></div>

<div class="codehilite"><pre><span></span><code>chmod +x ./rebuildapp.sh
</code></pre></div>

<p>Next run the script which will download the newest files. </p>
<div class="codehilite"><pre><span></span><code>sudo bash ./rebuildapp.sh
</code></pre></div>

<p>You'll be prompted to enter multiple settings.</p>
<div class="admonition key">
<p class="admonition-title">Caching</p>
<p>The code that you have updated may not show up because it is cached in the browser. Forcing the browser to refresh the cache will allow the new code to show up.</p>
<p>When you go to the "Request Service" page and when you go to the "Admin" page, you'll need to refresh the cache.</p>
<p>Holding Ctrl and pressing the <span class="amz-white-button"><span class="material-symbols-outlined">refresh</span></span> button on your browser will normally force a cache refresh.</p>
<p>You can also try Ctrl-Shift-R or CMD-Shift-R or Ctrl-F5</p>
</div>
<p>Once you've completed, check the following:</p>
<ol>
<li>Can you submit a Service Request from the Request Page?</li>
<li>Can you log in to the Admin area?</li>
<li>Can you update a status from the Admin Area?</li>
<li>Do Completed items disappear from the Service Request page?</li>
<li>Do items with a status that is not Completed or New Request show up on the Service Request page?</li>
</ol>
<h2 id="lab-summary">Lab Summary:</h2>
<p>In this lab, you extended your vehicle service application by building and integrating an API to handle data securely for technicians. The key tasks included creating a new API Gateway resource, adding a PUT method for updating service requests, implementing an authorizer for security, and updating the Lambda function to interact with DynamoDB. You also updated the web application enabling administrators to manage these requests securely.</p>
<h3 id="key-concepts-explained">Key Concepts Explained:</h3>
<ul>
<li><strong>API Gateway and Lambda Integration</strong>: API Gateway acts as a front door for applications to access data, business logic, or functionality from your backend services. In this lab, you created new endpoints in API Gateway that integrate with AWS Lambda functions. This setup allows your application to handle HTTP requests and execute backend logic without managing any servers.</li>
<li><strong>Cognito Authorizer</strong>: By using Amazon Cognito as an authorizer, you ensured that only authenticated users can access certain API endpoints. This enhances security by validating tokens included in requests, thereby controlling access based on user authentication status.</li>
<li><strong>DynamoDB Operations</strong>: You updated your Lambda functions to perform CRUD (Create, Read, Update, Delete) operations on the DynamoDB table. DynamoDB is a managed NoSQL database service that provides fast and predictable performance with seamless scalability. By leveraging DynamoDB, your application can efficiently handle and store service request data.</li>
</ul>
<h3 id="reflective-questions">Reflective Questions:</h3>
<ul>
<li>How does using an authorizer with API Gateway improve the security of your application?</li>
<li>What are the benefits of using a serverless architecture with AWS Lambda and DynamoDB for managing backend operations?</li>
<li>How do API Gateway, Lambda, and DynamoDB work together to create a scalable and secure backend for your application?</li>
<li>What considerations should you take into account when designing an API to handle sensitive data, such as service requests?</li>
</ul>
	</article>
	<script src="https://byui-cse.github.io/itm300-course/shared/lib/highlight/highlight.pack.js"></script>
	<script src="https://byui-cse.github.io/itm300-course/shared/lib/katex/katex.min.js"></script>
    <script src="https://byui-cse.github.io/itm300-course/shared/lib/katex/contrib/auto-render.min.js"></script>
	<script src="https://byui-cse.github.io/itm300-course/shared/lib/smartquotes/smartquotes.min.js"></script>
    <script>

        /* Startup scripts for katex rendering */
    	renderMathInElement(document.body,
		{
			delimiters: [
				{left: "$$", right: "$$", display: true},
				{left: "$", right: "$", display: false},
			]
    	});

        /* Highlighting code */
    	hljs.initHighlightingOnLoad();
    	var elements = document.querySelectorAll('.language-text')
		for (var i = 0; i < elements.length; i++) {
  			elements[i].classList.add('hljs');
		}

        /* TOC support */
        var hideContents = function(e){
            console.log(e.target);
            if(e.target.id === 'modal-screen' || e.target.nodeName.toLowerCase() === 'i') {
                e.preventDefault();
                document.querySelector('#contents-wrapper').classList.remove('active');
                document.querySelector('#modal-screen').classList.remove('active');
            }
        }

        var showContents = function(e){
            e.preventDefault();
            document.querySelector('#contents-wrapper').classList.add('active');
            document.querySelector('#modal-screen').classList.add('active');
        }

        document.querySelector("#hide-contents").addEventListener('click', hideContents);
        document.querySelector("#modal-screen").addEventListener('click', hideContents);
        document.querySelector("#show-contents").addEventListener('click', showContents);
    	
    </script>
</body>
</html>