<!DOCTYPE html>
<html>
<head>
	<title>Module 03: Project 3 Lab - Connect with Cognito</title>
    <style>
        @font-face {
            font-family: 'icomoon';
            src: url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.eot');
            src: url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.eot#iefix-8k8p81') format('embedded-opentype'), url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.ttf') format('truetype'), url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.woff') format('woff'), url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.svg#icomoon') format('svg');
            font-weight: normal;
            font-style: normal;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/reset.css">
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/fonts/fontawesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/lib/katex/katex.min.css">
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/lib/highlight/styles/monokai-sublime.min.css">
	<link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/cse450.css?v1.5.2">
    <meta charset="utf-8">

</head>
<body class="index-page">
     <div id="modal-screen">
        <div id="contents-wrapper">
            <div class="toc">
<ul>
<li><a href="#product-objective">Product Objective</a></li>
<li><a href="#open-up-the-lab-evironment">Open up the lab evironment</a></li>
<li><a href="#create-a-user-pool">Create a User Pool</a></li>
<li><a href="#create-a-user">Create a User</a></li>
<li><a href="#explore-the-hosted-ui">Explore the Hosted UI</a></li>
<li><a href="#update-password-for-user">Update Password for User</a></li>
<li><a href="#update-the-app-logic">Update the App logic</a></li>
<li><a href="#connect-with-our-app">Connect with our APP</a></li>
<li><a href="#log-in">Log in</a></li>
</ul>
</div>

            <a href="#" id="hide-contents" title="Close Table of Contents"><i class="far fa-window-close"></i></a>
        </div>
    </div>
	<header>
        <span class="icon-byui-logo"></span>
        <div id="titles">
            <h1>ITM 300 - Cloud Foundations</h1>
            <h2>Module 03: Project 3 Lab - Connect with Cognito</h2>
            <nav><a href="https://byui-cse.github.io/itm300-course"><i class="fas fa-home"></i></a><a href="https://byui-cse.github.io/itm300-course/modules/">Modules</a><a href="https://byui-cse.github.io/itm300-course/test-prep/">Test Prep</a></nav>
        </div>
        <a href="#" id="show-contents" title="Show Table of Contents"><i class="far fa-list-alt"></i></a>
    </header>
	<article>
		<p><img alt="Quick Oil Change and Repair" src="https://byui-cse.github.io/itm300-course/shared/img/quick-logo-login.jpg" />
<em><a href="https://openai.com/dall-e-3">Photo by Dall-E-3</a></em></p>
<h2 id="product-objective">Product Objective</h2>
<p>You will be connecting your website with AWS Cognito. Cognito will allow you to register users, store usernames and passwords, and login and logout. For this lab we'll be creating Cognito user pool, create users, learn about the hosted UI, and connect the website to Cognito to allow us to get a JWT token after authenticating with Cognito.</p>
<h2 id="open-up-the-lab-evironment">Open up the lab evironment</h2>
<p>Go to AWS Academy and get into the "Learner Lab" course. Start up the Learner Lab and go to the AWS console by clicking on the green dot when it appears.</p>
<h2 id="create-a-user-pool">Create a User Pool</h2>
<p>We'll first create a user pool which will store all of our users.</p>
<div class="admonition key">
<p class="admonition-title">Security Concerns</p>
<p>We will be creating a very simple setup. There are many more options that can be enabled to enhance the security of the app. This tutorial will cover basics to get you exposure to the concepts. In a production app, you'd want to enable more of the security features.</p>
<p>It is recommended that you play around with different options after you get the tutorial completed to expand your knowledge and understanding of the options available.</p>
</div>
<ul>
<li>Search for Cognito in AWS.</li>
<li>Click on Create User Pool</li>
<li>Don't click Federated identity providers</li>
<li>
<p>Choose User Name under Cognito user pool sign-in options</p>
<ul>
<li>You could store more user details, but for our example we'll simply be storing usernames and passwords.</li>
</ul>
</li>
<li>
<p>User the cognito defaults</p>
</li>
<li>No MFA<ul>
<li>Using Multifactor Authentication is more secure and would normally be enabled in a production environment</li>
</ul>
</li>
<li>
<p>Uncheck Cognito user pool sign-in options</p>
</li>
<li>
<p>Uncheck Enable self-registration</p>
<ul>
<li>We are going to manually add users, which are just the administrators of the application.</li>
</ul>
</li>
<li>
<p>Leave all other defaults</p>
</li>
<li>
<p>Choose Send email with Cognito</p>
</li>
<li>
<p>Give the User Pool a name of VehicleAppUserPool</p>
</li>
<li>Check Use the Cognito Hosted UI</li>
<li>Choose a unique hosted URL name ()</li>
<li>Choose Other for App type</li>
<li>Choose a unique name for your app (e.g. Vehicle App - Quick)</li>
<li>Add the following to the allowed callback urls: http://localhost:5500, http://localhost:3000, and your website's Public IPv4 DNS address.</li>
</ul>
<h2 id="create-a-user">Create a User</h2>
<p>Once your user pool is created, scroll down to where you see users and click Create User</p>
<ul>
<li>Don't send an invite</li>
<li>Create a user named janedoe</li>
<li>Password: ILove2SeeTheTemple!</li>
</ul>
<p>You'll notice that the user has a confirmation status of Force change password. We will go update their status by logging in to the hosted UI.</p>
<h2 id="explore-the-hosted-ui">Explore the Hosted UI</h2>
<ul>
<li>Click on the tab App Integration</li>
<li>
<p>Scroll to the bottom of the screen and click on VehicleApp</p>
</li>
<li>
<p>Scroll down until you see View Hosted UI and click on it.</p>
</li>
</ul>
<p>The Hosted UI will open in a new tab. We could use this interface for our user login page. However, we will be using an API call to authenticate with Cognito to give the user a more unified experience with the website.</p>
<h2 id="update-password-for-user">Update Password for User</h2>
<p>Log in as janedoe.</p>
<p>You'll see that you are promped with a Change Password prompt.</p>
<p>Update your password to Ilove2SeeTheTemple!!</p>
<p>You'll notice that it will try to send you back to localhost:5500. This was the first allowed callback URL.</p>
<h2 id="update-the-app-logic">Update the App logic</h2>
<p>Connect to your Vehicle App EC2 Instance</p>
<p>Download the newest website app:</p>
<div class="codehilite"><pre><span></span><code><span class="n">sudo</span><span class="w"> </span><span class="n">dnf</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">y</span><span class="w"> </span><span class="n">wget</span>
<span class="n">wget</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">byui</span><span class="o">-</span><span class="n">cse</span><span class="o">/</span><span class="n">itm300</span><span class="o">-</span><span class="n">course</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">module</span><span class="o">-</span><span class="mi">03</span><span class="o">/</span><span class="n">quick</span><span class="o">-</span><span class="n">oil</span><span class="o">-</span><span class="n">part3</span><span class="o">.</span><span class="n">zip</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">lab</span><span class="o">-</span><span class="n">app</span>
<span class="n">sudo</span><span class="w"> </span><span class="n">rm</span><span class="w"> </span><span class="o">-</span><span class="n">rf</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/*</span>
<span class="n">unzip</span><span class="w"> </span><span class="n">quick</span><span class="o">-</span><span class="n">oil</span><span class="o">-</span><span class="n">part3</span><span class="o">.</span><span class="n">zip</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">lab</span><span class="o">-</span><span class="n">app</span>
<span class="n">mv</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">lab</span><span class="o">-</span><span class="n">app</span><span class="o">/</span><span class="n">quick</span><span class="o">-</span><span class="n">oil</span><span class="o">-</span><span class="n">part3</span><span class="o">/*</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span>
<span class="n">rm</span><span class="w"> </span><span class="o">-</span><span class="n">rf</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">lab</span><span class="o">-</span><span class="n">app</span><span class="o">/</span>
</code></pre></div>

<p>Visit your nip.io address in a new tab to make sure the website is running</p>
<h2 id="connect-with-our-app">Connect with our APP</h2>
<p>You'll need to make a few changes to the code to connect your app to the cognito user pool you just created.</p>
<p>Using whatever text editor you like, or optionally after installing cloud9, go out and update the following files:</p>
<p>In /var/www/html/scripts/login.js update line 23 and 24 <strong>UserPoolId</strong> and <strong>ClientId</strong>. These values can be found from the Cognito user pool information.</p>
<p>In /var/www/html/scripts/getMessage.js update line 10 <strong>hostedUI</strong>. For this value, you'll need to copy the Hosted UI link and then make a few modifications to it.</p>
<p>Here is an example link: </p>
<div class="codehilite"><pre><span></span><code>https://vehicleappname.auth.us-east-1.amazoncognito.com/oauth2/authorize?client_id=3dhpqb95cm2nmutoh3vmpbqsva&amp;response_type=code&amp;scope=email+openid+phone&amp;redirect_uri=http%3A%2F%2Flocalhost%3A3000%2F
</code></pre></div>

<p>You'll update it so that it has the following:</p>
<ul>
<li>Your Cognito Domain (Found under app integration tab): https://vehicleappname.auth.us-east-1.amazoncognito.com/</li>
<li>oauth2/authorize? (this stays the same for everyone)</li>
<li>client_id=YOUR-CLIENT-ID-GOES-HERE</li>
<li>&amp;response_type=token</li>
<li>&amp;scope=email+openid+phone</li>
<li>&amp;redirect=ec2-44-221-155-86.compute-1.amazonaws.com</li>
</ul>
<p>I would end up with something like this:</p>
<div class="codehilite"><pre><span></span><code>https://vehicleappname.auth.us-east-1.amazoncognito.com/oauth2/authorize?client_id=3dhpqb95cm2nmumoh7smpbqsva&amp;response_type=token&amp;scope=email+openid+phone&amp;redirect_uri=ec2-44-221-155-86.compute-1.amazonaws.com
</code></pre></div>

<h2 id="log-in">Log in</h2>
<p>Once you've connected everything, you can log in.</p>
<p>Go to the login page of your website. Enter the username and password.</p>
<p>If you are successful, it will bring you to the private.html page and say "thank you for Logging in". If you have a username or password error, it will take you back to the login page and ask you to login. If you haven't updated your password, it will give you a message that says you need to go to the hosted ui and update your password.</p>
<p>The error console should also give you further ideas if something isn't working correctly.</p>
	</article>
	<script src="https://byui-cse.github.io/itm300-course/shared/lib/highlight/highlight.pack.js"></script>
	<script src="https://byui-cse.github.io/itm300-course/shared/lib/katex/katex.min.js"></script>
    <script src="https://byui-cse.github.io/itm300-course/shared/lib/katex/contrib/auto-render.min.js"></script>
	<script src="https://byui-cse.github.io/itm300-course/shared/lib/smartquotes/smartquotes.min.js"></script>
    <script>

        /* Startup scripts for katex rendering */
    	renderMathInElement(document.body,
		{
			delimiters: [
				{left: "$$", right: "$$", display: true},
				{left: "$", right: "$", display: false},
			]
    	});

        /* Highlighting code */
    	hljs.initHighlightingOnLoad();
    	var elements = document.querySelectorAll('.language-text')
		for (var i = 0; i < elements.length; i++) {
  			elements[i].classList.add('hljs');
		}

        /* TOC support */
        var hideContents = function(e){
            console.log(e.target);
            if(e.target.id === 'modal-screen' || e.target.nodeName.toLowerCase() === 'i') {
                e.preventDefault();
                document.querySelector('#contents-wrapper').classList.remove('active');
                document.querySelector('#modal-screen').classList.remove('active');
            }
        }

        var showContents = function(e){
            e.preventDefault();
            document.querySelector('#contents-wrapper').classList.add('active');
            document.querySelector('#modal-screen').classList.add('active');
        }

        document.querySelector("#hide-contents").addEventListener('click', hideContents);
        document.querySelector("#modal-screen").addEventListener('click', hideContents);
        document.querySelector("#show-contents").addEventListener('click', showContents);
    	
    </script>
</body>
</html>