<!DOCTYPE html>
<html>
<head>
	<title>Module 01: Project 2 Lab - Host a Website on EC2</title>
    <style>
        @font-face {
            font-family: 'icomoon';
            src: url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.eot');
            src: url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.eot#iefix-8k8p81') format('embedded-opentype'), url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.ttf') format('truetype'), url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.woff') format('woff'), url('https://byui-cse.github.io/itm300-course/shared/fonts/byui/icomoon.svg#icomoon') format('svg');
            font-weight: normal;
            font-style: normal;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/reset.css">
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/fonts/fontawesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/lib/katex/katex.min.css">
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/lib/highlight/styles/monokai-sublime.min.css">
	<link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/itm300-course/shared/cse450.css?v1.5.1">
    <meta charset="utf-8">

</head>
<body class="index-page">
     <div id="modal-screen">
        <div id="contents-wrapper">
            <div class="toc">
<ul>
<li><a href="#product-objective">Product Objective</a></li>
<li><a href="#open-up-the-lab-evironment">Open up the lab evironment</a></li>
<li><a href="#create-a-vpc">Create a VPC</a></li>
<li><a href="#create-an-ec2-instance">Create an EC2 instance</a></li>
<li><a href="#server-setup">Server Setup:</a></li>
<li><a href="#download-the-following-files">Download the following files:</a></li>
<li><a href="#assign-an-elastic-ip">Assign an Elastic IP</a></li>
<li><a href="#enable-ssl">Enable SSL</a></li>
<li><a href="#helpful-other-links">Helpful other links:</a></li>
</ul>
</div>

            <a href="#" id="hide-contents" title="Close Table of Contents"><i class="far fa-window-close"></i></a>
        </div>
    </div>
	<header>
        <span class="icon-byui-logo"></span>
        <div id="titles">
            <h1>ITM 300 - Cloud Foundations</h1>
            <h2>Module 01: Project 2 Lab - Host a Website on EC2</h2>
            <nav><a href="https://byui-cse.github.io/itm300-course"><i class="fas fa-home"></i></a><a href="https://byui-cse.github.io/itm300-course/modules/">Modules</a><a href="https://byui-cse.github.io/itm300-course/test-prep/">Test Prep</a></nav>
        </div>
        <a href="#" id="show-contents" title="Show Table of Contents"><i class="far fa-list-alt"></i></a>
    </header>
	<article>
		<p><img alt="Quick Oil Change and Repair" src="https://byui-cse.github.io/itm300-course/shared/img/quick-logo.jpg" />
<em><a href="https://openai.com/dall-e-3">Photo by Dall-E-3</a></em></p>
<h2 id="product-objective">Product Objective</h2>
<p>You will be hosting a website for your client on EC2. We'll also install an ssl certificate. The files for the website are provided for you.</p>
<h2 id="open-up-the-lab-evironment">Open up the lab evironment</h2>
<p>Go to AWS Academy and get into the "Learner Lab" course. Start up the Learner Lab and go to the AWS console by clicking on the green dot when it appears.</p>
<h2 id="create-a-vpc">Create a VPC</h2>
<p>Please create a VPC with 2 public subnets and 2 private subnets. Make sure these are in the us-east-1 area (N. Virginia). </p>
<ul>
<li>Under name tag use: vehicleapp</li>
<li>Number of Availability Zones: 2</li>
<li>VPC Endpoints: None</li>
</ul>
<h2 id="create-an-ec2-instance">Create an EC2 instance</h2>
<ul>
<li>Name the server vehicleapp-1</li>
<li>Use the vockey for your keypair</li>
<li>Use the vehicleapp-vpc VPC</li>
<li>place the EC2 instance in the vehicleapp-subnet-public1 subnet. </li>
<li>Enable auto assign an IP address</li>
<li>Create a security Group and name it vehicle-sg<ul>
<li>Add security rules to enable ports 80 (HTTP), 443 (HTTPS), and 22 (SSH) all from anywhere</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Quickly Connecting to your Instance</p>
<p>If you use the vockey when you set up the server, you can do the following to easily connect without needing to use a ssh client.</p>
<p>From the EC2 view of all instances do the following:</p>
<ul>
<li>Click the checkmark next to your instance name</li>
<li>Click Connect at the top of the screen.</li>
<li>Click Connect at the bottom of the next screen.</li>
</ul>
</div>
<h2 id="server-setup">Server Setup:</h2>
<p>Once you are connected to the EC2, run the following commands. Full instructions and explainations are found in the link below.</p>
<div class="codehilite"><pre><span></span><code>sudo dnf update -y
</code></pre></div>

<p>Install the latest versions of Apache web server and PHP packages.</p>
<div class="codehilite"><pre><span></span><code>sudo dnf install -y httpd wget php-fpm php-mysqli php-json php php-devel
</code></pre></div>

<p>Install the MariaDB software packages. Use the dnf install command to install multiple software packages and all related dependencies at the same time.</p>
<div class="codehilite"><pre><span></span><code>sudo dnf install mariadb105-server
</code></pre></div>

<p>Start the Apache web server.</p>
<div class="codehilite"><pre><span></span><code>sudo systemctl start httpd
</code></pre></div>

<p>Use the systemctl command to configure the Apache web server to start at each system boot. </p>
<div class="codehilite"><pre><span></span><code>sudo systemctl enable httpd
</code></pre></div>

<p>Add your user (in this case, ec2-user) to the apache group.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">sudo</span><span class="w"> </span><span class="nv">usermod</span><span class="w"> </span><span class="o">-</span><span class="nv">a</span><span class="w"> </span><span class="o">-</span><span class="nv">G</span><span class="w"> </span><span class="nv">apache</span><span class="w"> </span><span class="nv">ec2</span><span class="o">-</span><span class="nv">user</span>
<span class="k">exit</span>
</code></pre></div>

<p>You'll need to disconnect and reconnect to the EC2 terminal</p>
<p>Change the group ownership of /var/www and its contents to the apache group.
To add group write permissions and to set the group ID on future subdirectories, change the directory permissions of /var/www and its subdirectories.
To add group write permissions, recursively change the file permissions of /var/www and its subdirectories:</p>
<div class="codehilite"><pre><span></span><code><span class="n">sudo</span><span class="w"> </span><span class="n">chown</span><span class="w"> </span><span class="o">-</span><span class="n">R</span><span class="w"> </span><span class="n">ec2</span><span class="o">-</span><span class="n">user</span><span class="p">:</span><span class="n">apache</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span>
<span class="n">sudo</span><span class="w"> </span><span class="n">chmod</span><span class="w"> </span><span class="mi">2775</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="w"> </span><span class="o">-</span><span class="n">type</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">-</span><span class="n">exec</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">chmod</span><span class="w"> </span><span class="mi">2775</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>\<span class="p">;</span>
<span class="n">find</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="w"> </span><span class="o">-</span><span class="n">type</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">-</span><span class="n">exec</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">chmod</span><span class="w"> </span><span class="mi">0664</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>\<span class="p">;</span>
</code></pre></div>

<p>Create a PHP file in the Apache document root.</p>
<div class="codehilite"><pre><span></span><code><span class="nx">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="cp">&lt;?php</span> <span class="nb">phpinfo</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="err">/var/www/html/phpinfo.php</span>
</code></pre></div>

<p>Go to http://{REPLACEWITHYOURINSTANCEIPADDRESS}/phpinfo.php and make sure you get a page that works (note that it is on http and not https)</p>
<p>Delete the phpinfo.php file. Although this can be useful information, it should not be broadcast to the internet for security reasons.</p>
<div class="codehilite"><pre><span></span><code><span class="n">rm</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">phpinfo</span><span class="o">.</span><span class="n">php</span>
</code></pre></div>

<p>Full instructions are found here if you want more details on the code above:</p>
<p><a href="https://docs.aws.amazon.com/linux/al2023/ug/ec2-lamp-amazon-linux-2023.html">Hosting Website on EC2 using a LAMP stack</a></p>
<h2 id="download-the-following-files">Download the following files:</h2>
<p>Use the following commands to download the zip containing the website you are going to host on EC2. This will happen after you connect to the EC2 instance via ssh.</p>
<div class="codehilite"><pre><span></span><code><span class="n">sudo</span><span class="w"> </span><span class="n">dnf</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">y</span><span class="w"> </span><span class="n">wget</span>
<span class="n">wget</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">byui</span><span class="o">-</span><span class="n">cse</span><span class="o">/</span><span class="n">itm300</span><span class="o">-</span><span class="n">course</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">module</span><span class="o">-</span><span class="mi">02</span><span class="o">/</span><span class="n">quick</span><span class="o">-</span><span class="n">oil</span><span class="o">-</span><span class="n">part2</span><span class="o">.</span><span class="n">zip</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">lab</span><span class="o">-</span><span class="n">app</span>
<span class="n">unzip</span><span class="w"> </span><span class="n">quick</span><span class="o">-</span><span class="n">oil</span><span class="o">-</span><span class="n">part2</span><span class="o">.</span><span class="n">zip</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">lab</span><span class="o">-</span><span class="n">app</span>
<span class="n">mv</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">lab</span><span class="o">-</span><span class="n">app</span><span class="o">/</span><span class="n">quick</span><span class="o">-</span><span class="n">oil</span><span class="o">-</span><span class="n">part2</span><span class="o">/*</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span>
<span class="n">rm</span><span class="w"> </span><span class="o">-</span><span class="n">rf</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">lab</span><span class="o">-</span><span class="n">app</span><span class="o">/</span>
</code></pre></div>

<h2 id="assign-an-elastic-ip">Assign an Elastic IP</h2>
<p>Go to the Elastic IPs on the sidebar of the EC2 dashboard. Allocate an Elastic IP address and then associate that elastic IP address with your instance.</p>
<h2 id="enable-ssl">Enable SSL</h2>
<p>We'll use openssl to generate a private key and a certificate that is self signed. For a live website, you'd need to get the certificate signed by a certificate authority and that would require a registered domain name. Using nip.io we'll create a pseudo domain name we can use for creating the ssl certificate, but we won't get it signed with a CA. So it will still give you a "not secure" warning even though it is serving up files across SSL/HTTPS.</p>
<div class="codehilite"><pre><span></span><code>sudo dnf install -y openssl mod_ssl
</code></pre></div>

<div class="codehilite"><pre><span></span><code>sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/pki/tls/private/apache-selfsigned.key -out /etc/pki/tls/certs/apache-selfsigned.crt
</code></pre></div>

<p>Country Name (2 letter code) [XX]:<strong>US</strong></p>
<p>State or Province Name (full name) []:<strong>Idaho</strong></p>
<p>Locality Name (eg, city) [Default City]:<strong>Rexburg</strong></p>
<p>Organization Name (eg, company) [Default Company Ltd]:<strong>MyCo</strong></p>
<p>Organizational Unit Name (eg, section) []:<strong>Development</strong></p>
<p>For the common name we'll use a service called nip.io. You need to take your static ip address that you have for the EC2 and replace the periods with dashes like this:
52.91.237.254 becomes 52-91-237-254. Then add .nip.io to the end to get the common name.</p>
<p>Common Name (eg, your name or your server's hostname) []:<strong>52-91-237-254.nip.io</strong></p>
<p>Email Address []:<strong>youremail@byui.edu</strong></p>
<div class="codehilite"><pre><span></span><code>sudo systemctl restart httpd
</code></pre></div>

<p>Submit a screenshot of your website running over https. You'll need to accept the warning and proceed to the website.</p>
<h2 id="helpful-other-links">Helpful other links:</h2>
<p><a href="https://medium.com/@eikachiu/install-nginx-on-amazon-linux-2023-d032160bfc20">nginx on Amazon Linux 2023</a></p>
<p><a href="https://gist.github.com/atikju/1fb8d3e856e32f3b0a678d393914351b">nginx on Amazon Linux 2023 LAMP</a></p>
<p><a href="https://www.digicert.com/kb/ssl-support/openssl-quick-reference-guide.htm">OpenSSL Quick Reference Guide</a></p>
	</article>
	<script src="https://byui-cse.github.io/itm300-course/shared/lib/highlight/highlight.pack.js"></script>
	<script src="https://byui-cse.github.io/itm300-course/shared/lib/katex/katex.min.js"></script>
    <script src="https://byui-cse.github.io/itm300-course/shared/lib/katex/contrib/auto-render.min.js"></script>
	<script src="https://byui-cse.github.io/itm300-course/shared/lib/smartquotes/smartquotes.min.js"></script>
    <script>

        /* Startup scripts for katex rendering */
    	renderMathInElement(document.body,
		{
			delimiters: [
				{left: "$$", right: "$$", display: true},
				{left: "$", right: "$", display: false},
			]
    	});

        /* Highlighting code */
    	hljs.initHighlightingOnLoad();
    	var elements = document.querySelectorAll('.language-text')
		for (var i = 0; i < elements.length; i++) {
  			elements[i].classList.add('hljs');
		}

        /* TOC support */
        var hideContents = function(e){
            console.log(e.target);
            if(e.target.id === 'modal-screen' || e.target.nodeName.toLowerCase() === 'i') {
                e.preventDefault();
                document.querySelector('#contents-wrapper').classList.remove('active');
                document.querySelector('#modal-screen').classList.remove('active');
            }
        }

        var showContents = function(e){
            e.preventDefault();
            document.querySelector('#contents-wrapper').classList.add('active');
            document.querySelector('#modal-screen').classList.add('active');
        }

        document.querySelector("#hide-contents").addEventListener('click', hideContents);
        document.querySelector("#modal-screen").addEventListener('click', hideContents);
        document.querySelector("#show-contents").addEventListener('click', showContents);
    	
    </script>
</body>
</html>